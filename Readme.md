# AxmosDB

AxmosDB is an experimental relational database server written in Rust, designed to explore modern database internals with a clean, modular architecture.

It implements a full query execution pipeline—from parsing to optimization and execution—while focusing on correctness, performance, and extensibility.

## Features

* ACID-compliant transactions.
* B+Tree index-organized storage engine.
* Custom pager inspired by SQLite v3.0.
    - Uses direct-io for reliable writes.
    - Includes a page cache with LRU policy.
    - Leverages a write-ahead log for recoverability.

* Page-level latching.
* Concurrent-safe access.
* MVCC support via snapshot isolation.
* The AxmosDB SQL engine includes:
    - A Custom SQL parser
    - Cascades-based query optimizer inspired by Microsoft SQL Server.

All of this is written for fun and from scratch.

# Project Structure

## axmos-server:
Database server binary

## axmos-client:
TCP client for interacting with the server

# Core modules:

* **types** - AxmosDB typesystem module, autogenerated by a derive macro.

* **storage** – Index-organized storage model inspired by InnoDB and SQLite.

* **tree** – B+Tree storage engine

* **io** – Page cache and disk IO

* **sql** – Parser, binder, planner

* **runtime** – Query execution

* **tcp** – Network protocol

* **schema** – Schema and metadata management

# Running the Server (Development Mode)

Start the server

```bash
cargo run --bin axmos-server -- -p 5432
```
Optionally open a database file on startup:

```bash
cargo run --bin axmos-server -- -p 5432 -f mydb.axm
```
Start the client

In another terminal:

```bash
cargo run --bin axmos-client -- -p 5432
```

The client connects via TCP and allows you to issue SQL and control commands.

# TCP Protocol Overview

AxmosDB uses a custom binary TCP protocol.

## Supported Request Types

CREATEDB <path> – Create a database

OPENDB <path> – Open an existing database

SQL <query> – Execute a SQL statement

EXPLAIN <query> – Show the execution plan

ANALYZE – Collect table statistics

CLOSE – Close the current database

PING – Health check

SHUTDOWN – Stop the server

Server Responses

OK – Successful operation

ERROR – Error message

ROWS – Result set

ROWS_AFFECTED – Number of affected rows

DDL – DDL execution result

EXPLAIN – Query plan output

PONG – Response to PING

GOODBYE – Connection closed

SHUTTING_DOWN – Server shutdown initiated

# Example SQL Session

```
CREATEDB db-test.axm

CREATE TABLE users (id BIGINT, name TEXT, age INT)

INSERT INTO users VALUES (4, 'Alice', 25)

INSERT INTO users VALUES (5, 'Bob', 45)

SELECT * FROM users

SELECT * FROM users WHERE age > 26

UPDATE users SET name = 'Pablo' WHERE id = 4

CREATE INDEX idx_users_name ON users(name) // Indexes are only UNIQUE indexes. The keyword UNIQUE is supported but does not do anything in practice since indexes are unique anyway.

SELECT * FROM users

DELETE FROM users WHERE id = 4

SELECT * FROM users

CREATE TABLE orders (userid BIGINT, product_name TEXT)

INSERT INTO orders VALUES (4, 'Car')

INSERT INTO orders VALUES (5, 'House')

SELECT * FROM users JOIN orders ON users.id = orders.userid

BEGIN

DELETE FROM orders WHERE id = 4

SELECT * FROM orders

ROLLBACK

SELECT * FROM orders


VACUUM



EXPLAIN SELECT * FROM users JOIN orders ON users.id = orders.userid

ANALYZE

PING
QUIT
SHUTDOWN

```

# Query Optimization

AxmosDB uses a Cascades-style optimizer, enabling:

* Rule-based transformations

* Cost-based plan selection

* Statistics-driven decisions (via ANALYZE)

* Future extensibility for advanced operators

# Known Limitations & TODOs

## Pending Features

## REVIEW AND REFACTOR TEST FRAMEWORK
### Join operators:

* Merge Join

* Hash Join

### Sorting:

* External Sort

### Subqueries:

* Subqueries are still not implemented

These are actively planned and will integrate with the Cascades optimizer.

## Status

AxmosDB is under active development and intended for:

* Learning

* Research

Database internals experimentation

It is not production-ready, but correctness and architecture are first-class goals.

## License

MIT
